<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NutriAI - Create Your Meal Plan</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#13ec13",
            "background-light": "#f8fcf8",
            "background-dark": "#102210",
            "text-light": "#0d1b0d",
            "text-dark": "#e7f3e7",
            "subtle-light": "#4c9a4c",
            "subtle-dark": "#a3d3a3",
            "border-light": "#cfe7cf",
            "border-dark": "#2a4a2a",
            "surface-light": "#e7f3e7",
            "surface-dark": "#1a3a1a",
            accent: "#FFC107",
          },
          fontFamily: { display: ["Space Grotesk", "sans-serif"] },
          borderRadius: {
            DEFAULT: "0.5rem",
            lg: "0.75rem",
            xl: "1rem",
            full: "9999px",
          },
        },
      },
    };
  </script>

  <style>
    body { font-family: 'Space Grotesk', sans-serif; }
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
      font-size: 20px;
    }
    /* checkbox checkmark used in Step 2 */
    .custom-checkbox:checked {
      background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
    }
  </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark">
  <div class="relative flex min-h-screen w-full flex-col items-center">
    <div class="w-full max-w-5xl px-4 sm:px-6 lg:px-8 py-5">
      <!-- Header -->
      <header class="flex items-center justify-between whitespace-nowrap border-b border-border-light dark:border-border-dark px-4 py-3 sm:px-6">
        <a href="#" class="flex items-center gap-3 text-text-light dark:text-text-dark">
          <div class="size-6 text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" fill="currentColor">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M24 4H42V17.3333V30.6667H24V44H6V30.6667V17.3333H24V4Z" />
            </svg>
          </div>
          <h2 class="text-xl font-bold leading-tight tracking-tighter">NutriAI</h2>
        </a>
        <a href="#" class="flex min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-text-light text-sm font-bold leading-normal tracking-wide">
          <span class="truncate">Log In</span>
        </a>
      </header>

      <!-- Progress -->
      <div class="mt-6 sm:mt-8 px-4" id="progressWrap">
        <div class="flex items-center justify-between gap-4">
          <p class="text-base font-medium leading-normal" id="stepLabel">Step 1 of 3: Personal Info</p>
          <p class="text-sm font-medium leading-normal text-subtle-light dark:text-subtle-dark" id="percentLabel">33%</p>
        </div>
        <div class="mt-2 h-2 rounded-full bg-surface-light dark:bg-surface-dark">
          <div class="h-2 rounded-full bg-primary transition-all" id="progressBar" style="width: 33%"></div>
        </div>
      </div>

      <!-- Main -->
      <main class="mt-6 sm:mt-10">
        <!-- STEP 1: Personal Info (from first file) -->
        <section id="step1" class="block">
          <div class="mx-auto max-w-2xl text-center">
            <p class="text-4xl font-black leading-tight tracking-tighter md:text-5xl">Create Your Personalized Meal Plan</p>
            <p class="mt-3 text-base font-normal leading-normal text-subtle-light dark:text-subtle-dark">Tell us a bit about yourself so we can tailor the perfect meals for you.</p>
          </div>

          <div class="mx-auto mt-8 max-w-2xl">
            <!-- Social Buttons -->
            <div class="flex flex-col gap-4 px-4 py-3 sm:flex-row">
              <button type="button" class="flex h-12 flex-1 cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg bg-surface-light dark:bg-surface-dark px-5 text-base font-bold leading-normal tracking-wide text-text-light dark:text-text-dark">
                <img class="h-5 w-5" alt="Google logo" src="https://lh3.googleusercontent.com/aida-public/AB6AXuApj1WfXiZzQaTj6jQ-R-qFIdwPnP0GK-pn6DbSQJMQg5ZENjliB182RIFxQqMuE_qecD1MCnGQwSuM2nHcQ9RsoKNFscTI9WvQj8k57ox0KrIrJewv3k301_5wEYEaYWSnBFOhvWW_-ZL9DHOPqcktbBxoBo_yaRkARi-9EErHS0mAaAA_wYQDs1Tm2t6cP9_dZsqUsDUjgeS3Z1vFVBHTHEdV5AcKh7Kw33WvDuB9TuH4US6fiYW8fFlDsgoFzIRBfO_voGh70ADB" />
                <span class="truncate">Register with Google</span>
              </button>
              <button type="button" class="flex h-12 flex-1 cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg bg-surface-light dark:bg-surface-dark px-5 text-base font-bold leading-normal tracking-wide text-text-light dark:text-text-dark">
                <img class="h-5 w-5 dark:invert" alt="Apple logo" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDR6PnPmMbsIOsFbk1CGBVx53rv0hi69qqsyBd8dlNpuEyeNHC9Wz30wczI9SSxNk4TDHoJCBsdMrzVdOpKs_SeQ2X6ug0Zg_rZSI9L352hj-snwUxDBQz2eKfj9jKrMDorjqcENHn1RJ0whWczw1yKOXxu4kM2HVOfWSDOogN340fblYDExZE0zE0xlElfrzxRA-IHFSvkmzF8pvH3OsZ5Qzr1gnn2-mCIlDsQWlDaWBhZtVfq8xwZ4_PxwIl_xCt9U1sLlt29mK7Q" />
                <span class="truncate">Register with Apple</span>
              </button>
            </div>

            <div class="my-4 flex items-center px-4">
              <div class="flex-grow border-t border-border-light dark:border-border-dark"></div>
              <span class="mx-4 flex-shrink text-sm text-subtle-light dark:text-subtle-dark">OR</span>
              <div class="flex-grow border-t border-border-light dark:border-border-dark"></div>
            </div>

            <form id="formStep1" class="space-y-6">
              <div class="px-4">
                <label for="nick-name" class="block text-base font-medium leading-normal pb-2">Nick Name</label>
                <input id="nick-name" name="nick-name" type="text" placeholder="Enter your nick name" class="form-input block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light placeholder:text-subtle-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder:text-subtle-dark" />
                <p id="err-nick-name" class="mt-1 text-sm text-red-600 hidden"></p>
            </div>
              <div class="px-4">
                <label for="email" class="block text-base font-medium leading-normal pb-2">Email Address</label>
                <input id="email" name="email" type="email" placeholder="you@example.com" class="form-input block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light placeholder:text-subtle-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder:text-subtle-dark" />
              <p id="err-email" class="mt-1 text-sm text-red-600 hidden"></p>
             </div>
              <div class="px-4">
                <label for="password" class="block text-base font-medium leading-normal pb-2">Password</label>
                <input id="password" name="password" type="password" placeholder="Enter a strong password" class="form-input block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light placeholder:text-subtle-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder:text-subtle-dark" />
              <p id="err-password" class="mt-1 text-sm text-red-600 hidden"></p>
            </div>
              <div class="px-4">
                <label for="password-re" class="block text-base font-medium leading-normal pb-2">Confirm Password</label>
                <input id="password-re" name="password-re" type="password" placeholder="Confirm your password" class="form-input block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light placeholder:text-subtle-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder:text-subtle-dark" />
              <p id="err-password-re" class="mt-1 text-sm text-red-600 hidden"></p>
            </div>
              <div class="flex flex-col gap-6 px-4 sm:flex-row">
                <div class="flex-1">
                  <label for="age" class="block text-base font-medium leading-normal pb-2">Age</label>
                  <input id="age" name="age" type="number" placeholder="e.g. 28" class="form-input block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light placeholder:text-subtle-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark dark:placeholder:text-subtle-dark" />
                 <p id="err-age" class="mt-1 text-sm text-red-600 hidden"></p>

                </div>
                <div class="flex-1">
                  <label for="gender" class="block text-base font-medium leading-normal pb-2">Gender (Optional)</label>
                  <select id="gender" name="gender" class="form-select block w-full rounded-lg border border-border-light bg-background-light p-4 text-base text-text-light focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 dark:border-border-dark dark:bg-background-dark dark:text-text-dark">
                    <option>Select...</option>
                    <option>Male</option>
                    <option>Female</option>
                    <option>Prefer not to say</option>
                  </select>
                </div>
              </div>
              <div class="px-4 pt-2">
                <button type="submit" class="flex h-14 w-full cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-primary px-5 text-base font-bold leading-normal tracking-wide text-text-light">
                  <span class="truncate">Continue</span>
                </button>
              </div>
              <div class="px-4 text-center">
                <p class="text-xs text-subtle-light dark:text-subtle-dark">
                  By continuing, you agree to NutriAI's <a href="#" class="font-medium underline hover:text-primary">Terms of Service</a> and
                  <a href="#" class="font-medium underline hover:text-primary">Privacy Policy</a>.
                </p>
              </div>
            </form>
          </div>
        </section>

        <!-- STEP 2: Dietary Profile (from second file) -->
        <section id="step2" class="hidden">
          <div class="w-full max-w-3xl mx-auto">
            <!-- Heading -->
            <div class="text-center mb-8">
              <h1 class="text-4xl sm:text-5xl font-bold tracking-tight">Tell Us About Your Diet</h1>
              <p class="mt-3 text-base text-primary">This helps our AI create the perfect meal plan for you.</p>
            </div>

            <div class="space-y-12">
              <!-- Primary Goal -->
              <div>
                <h3 class="text-xl font-bold leading-tight tracking-tight px-4 pb-3 pt-4">What is your primary dietary goal?</h3>
                <p id="goal-error" class="px-4 -mt-2 mb-2 text-sm text-red-600 hidden"></p>
                <div class="flex flex-col gap-3 p-4">
                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="dietary-goal" class="h-5 w-5 appearance-none rounded-full border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary checked:ring-2 checked:ring-primary/20 focus:outline-none" checked />
                    <span class="text-base font-medium">Lose Weight</span>
                  </label>
                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="dietary-goal" class="h-5 w-5 appearance-none rounded-full border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary checked:ring-2 checked:ring-primary/20 focus:outline-none" />
                    <span class="text-base font-medium">Gain Muscle</span>
                  </label>
                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="radio" name="dietary-goal" class="h-5 w-5 appearance-none rounded-full border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary checked:ring-2 checked:ring-primary/20 focus:outline-none" />
                    <span class="text-base font-medium">Eat Healthy</span>
                  </label>
                </div>
              </div>

              <!-- Dietary Preferences -->
              <div>
                <h3 class="text-xl font-bold leading-tight tracking-tight px-4 pb-3 pt-4">Do you have any dietary preferences?</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 p-4">
                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="checkbox" class="custom-checkbox h-5 w-5 appearance-none rounded-md border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary focus:outline-none focus:ring-2 focus:ring-primary/20" />
                    <span class="material-symbols-outlined text-primary">eco</span>
                    <span class="text-base font-medium">Vegetarian</span>
                  </label>

                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="checkbox" class="custom-checkbox h-5 w-5 appearance-none rounded-md border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary focus:outline-none focus:ring-2 focus:ring-primary/20" />
                    <span class="material-symbols-outlined text-primary">grass</span>
                    <span class="text-base font-medium">Vegan</span>
                  </label>

                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="checkbox" class="custom-checkbox h-5 w-5 appearance-none rounded-md border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary focus:outline-none focus:ring-2 focus:ring-primary/20" />
                    <span class="material-symbols-outlined text-primary">grain</span>
                    <span class="text-base font-medium">Gluten-Free</span>
                  </label>

                  <label class="flex cursor-pointer items-center gap-4 rounded-lg border border-border-light dark:border-border-dark p-4 transition-all hover:border-primary dark:hover:border-primary has-[:checked]:border-primary has-[:checked]:bg-primary/10">
                    <input type="checkbox" class="custom-checkbox h-5 w-5 appearance-none rounded-md border-2 border-border-light dark:border-border-dark bg-transparent checked:border-primary checked:bg-primary focus:outline-none focus:ring-2 focus:ring-primary/20" />
                    <div class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-primary">nutrition</span>
                      <span class="text-base font-medium">Keto</span>
                      <div class="group relative flex items-center">
                        <span class="material-symbols-outlined text-accent text-lg cursor-help">info</span>
                        <div class="absolute bottom-full mb-2 w-48 rounded-lg bg-gray-800 p-2 text-xs text-white opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                          A low-carb, high-fat diet.
                        </div>
                      </div>
                    </div>
                  </label>
                </div>
              </div>

              <!-- Allergies & Dislikes -->
              <div>
                <h3 class="text-xl font-bold leading-tight tracking-tight px-4 pb-3 pt-4">Allergies &amp; Dislikes</h3>
                <div class="px-4">
                  <p class="text-sm text-subtle-light dark:text-subtle-dark mb-4">List any ingredients to avoid. Start typing for suggestions.</p>
                  <div class="relative">
                    <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-subtle-light dark:text-subtle-dark pointer-events-none">search</span>
                    <input type="text" placeholder="e.g., Peanuts, Shellfish, Cilantro" class="w-full rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-gray-800 py-3 pl-10 pr-4 focus:border-primary focus:ring-2 focus:ring-primary/20" />
                  </div>
                </div>
              </div>

              <!-- Navigation Buttons -->
              <div class="flex flex-col-reverse sm:flex-row items-center justify-between gap-4 pt-6">
                <button type="button" onclick="goToStep(1)" class="w-full sm:w-auto rounded-full px-8 py-3 text-base font-bold text-subtle-light dark:text-subtle-dark transition-colors hover:bg-gray-200 dark:hover:bg-gray-700">Back</button>
                <button type="button" onclick="finishForm()" class="w-full sm:w-auto rounded-full bg-primary px-8 py-3 text-base font-bold text-white transition-opacity hover:opacity-90">Finish</button>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

<script>
  (function () {
    // ---- helpers ----
    function showError(el, msg) {
      if (!el) return;
      el.setAttribute('aria-invalid', 'true');
      el.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-200');
      const id = el.id;
      const m = document.getElementById('err-' + id);
      if (m) { m.textContent = msg; m.classList.remove('hidden'); }
    }
    function clearError(el) {
      if (!el) return;
      el.removeAttribute('aria-invalid');
      el.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-200');
      const id = el.id;
      const m = document.getElementById('err-' + id);
      if (m) { m.textContent = ''; m.classList.add('hidden'); }
    }
    function containsEmoji(str) {
      try { return /\p{Extended_Pictographic}/u.test(str); } catch (e) { return false; }
    }

    // ---- Step 1 rules ----
    function validateStep1() {
      const nameEl = document.getElementById('nick-name');
      const emailEl = document.getElementById('email');
      const pwEl = document.getElementById('password');
      const ageEl = document.getElementById('age');

      let ok = true, firstBad = null;

      const nameVal = (nameEl.value || '').trim();
      // allow letters + numbers (Unicode), apostrophes, hyphens and spaces
      const nameAllowed = /^[\p{L}\p{N}'\- ]+$/u;
      if (nameVal.length < 2) {
        ok = false; firstBad ||= nameEl;
        showError(nameEl, 'Please enter at least 2 characters.');
      } else if (!nameAllowed.test(nameVal) || containsEmoji(nameVal)) {
        ok = false; firstBad ||= nameEl;
        showError(nameEl, 'Only letters, numbers, spaces, hyphens, apostrophes; no symbols/emoji.');
      }

      // Email basic format
      clearError(emailEl);
      const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
      if (!emailRe.test(emailEl.value || '')) {
        ok = false; firstBad ||= emailEl;
        showError(emailEl, 'Enter a valid email address.');
      }

      // Password: >=8, include letter + number + special char
      clearError(pwEl);
      const pw = pwEl.value || '';
      const hasLetter  = /[A-Za-z]/.test(pw);
      const hasNumber  = /[0-9]/.test(pw);
      const hasSpecial = /[!@#$%^&*()_\-+\=\[\]{};:'",.<>\/?\\|`~]/.test(pw);
      if (pw.length < 8 || !hasLetter || !hasNumber || !hasSpecial) {
        ok = false; firstBad ||= pwEl;
        showError(pwEl, 'Min 8 chars and include a letter, a number, and a special character.');
      }

      // Confirm Password: must match password
      const pwReEl = document.getElementById('password-re');
      clearError(pwReEl);
      const pwRe = pwReEl.value || '';
      if (pwRe !== pw) {
        ok = false; firstBad ||= pwReEl;
        showError(pwReEl, 'Passwords do not match.');
      }

      // Age: 13~120
      clearError(ageEl);
      const age = Number(ageEl.value);
      if (!Number.isInteger(age) || age < 13 || age > 120) {
        ok = false; firstBad ||= ageEl;
        showError(ageEl, 'Enter a valid age between 13 and 120.');
      }

      if (!ok && firstBad) firstBad.scrollIntoView({ behavior: 'smooth', block: 'center' });
      return ok;
    }

    // ---- Step 2 rule ----
    function validateStep2() {
      const goals = document.querySelectorAll('input[name="dietary-goal"]');
      const anyChecked = Array.from(goals).some(g => g.checked);
      const gh = document.getElementById('goal-error');
      if (!anyChecked) {
        if (gh) { gh.textContent = 'Please select a primary goal.'; gh.classList.remove('hidden'); }
        return false;
      }
      if (gh) { gh.textContent = ''; gh.classList.add('hidden'); }
      return true;
    }

    // ---- async duplicate email check ----
    async function checkEmailDuplicate(email) {
      // 기대 응답: { "exists": true/false }
      try {
        const res = await fetch(`/api/check-email?email=${encodeURIComponent(email)}`, { method: 'GET' });
        if (!res.ok) throw 0;
        const data = await res.json();
        return !!data.exists;
      } catch (_) {
        // 네트워크/엔드포인트 문제 시, 중복 아님으로 처리(UX 우선)
        return false;
      }
    }

    // ---- wire up step 1 submit ----
    (function () {
      // 기존 goToStep이 있으면 사용, 없으면 정의
      if (typeof window.goToStep !== 'function') {
        window.goToStep = function (n) {
          const stepLabel = document.getElementById('stepLabel');
          const percentLabel = document.getElementById('percentLabel');
          const progressBar = document.getElementById('progressBar');
          const s1 = document.getElementById('step1');
          const s2 = document.getElementById('step2');
          if (n === 1) {
            s1.classList.remove('hidden'); s1.classList.add('block');
            s2.classList.add('hidden'); s2.classList.remove('block');
            if (stepLabel) stepLabel.textContent = 'Step 1 of 3: Personal Info';
            if (percentLabel) percentLabel.textContent = '33%';
            if (progressBar) progressBar.style.width = '33%';
          } else if (n === 2) {
            s1.classList.add('hidden'); s1.classList.remove('block');
            s2.classList.remove('hidden'); s2.classList.add('block');
            if (stepLabel) stepLabel.textContent = 'Step 2 of 3: Dietary Profile';
            if (percentLabel) percentLabel.textContent = '66%';
            if (progressBar) progressBar.style.width = '66%';
          }
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };
      }

      const formStep1 = document.getElementById('formStep1');
      if (formStep1) {
        formStep1.addEventListener('submit', async (e) => {
          e.preventDefault();
          if (!validateStep1()) return;

          // 중복 이메일 조회
          const emailEl = document.getElementById('email');
          const exists = await checkEmailDuplicate(emailEl.value.trim());
          if (exists) {
            showError(emailEl, 'This email is already registered. Try logging in.');
            emailEl.focus();
            return;
          }

          goToStep(2);
        });
      }

      // 입력 중 에러 즉시 해제
      ['nick-name', 'email', 'password', 'password-re', 'age'].forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener('input', () => clearError(el));
      });

      // Finish 보강
      window.finishForm = function () {
        if (!validateStep2()) return;
        alert('Thanks! Your basic profile is ready. (Hook this up to your backend to proceed to Step 3: Schedule)');
      };
    })();
  })();
</script>

</body>
</html>
